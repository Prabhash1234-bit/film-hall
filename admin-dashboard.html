<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    h1, h2 {
      color: #222;
    }
    #movieContainer img {
      border-radius: 8px;
      margin-bottom: 8px;
    }
    .movie-card {
      background: white;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
  </style>
  <!-- ‚úÖ Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>

  <h1>üé¨ Admin Dashboard</h1>

  <h2>üéûÔ∏è Uploaded Movies</h2>
  <div id="movieContainer">Loading movies...</div>

  <h2>üìã Booking Report</h2>
  <div id="bookingContainer">Loading bookings...</div>

  <script>
    // ‚úÖ Replace with your actual Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "film-hall-booking",
      storageBucket: "film-hall-booking.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const movieContainer = document.getElementById("movieContainer");
    const bookingContainer = document.getElementById("bookingContainer");

    const movieTitlesMap = {};

    // ‚úÖ Load movies
    db.collection("movies").get().then(snapshot => {
      movieContainer.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        movieTitlesMap[doc.id] = data.title;

        const movieCard = `
          <div class="movie-card">
            <img src="${data.posterURL}" width="150">
            <h3>${data.title}</h3>
            <p><strong>Showtimes:</strong> ${Array.isArray(data.showtimes) ? data.showtimes.join(', ') : data.showtimes}</p>
            <p><strong>Price:</strong> ‚Çπ${data.price}</p>
          </div>
        `;
        movieContainer.innerHTML += movieCard;
      });

      // After loading movie titles, load bookings
      loadBookings();
    });

    // ‚úÖ Load bookings
    function loadBookings() {
      db.collection("bookings").get().then(snapshot => {
        if (snapshot.empty) {
          bookingContainer.innerHTML = "No bookings yet.";
          return;
        }

        let totalRevenue = 0;
        bookingContainer.innerHTML = "";

        snapshot.forEach(doc => {
          const data = doc.data();
          const movieTitle = movieTitlesMap[data.movieId] || "Unknown Movie";
          const seatCount = data.seats.length;
          const revenue = seatCount * data.price;
          totalRevenue += revenue;

          const bookingHTML = `
            <div class="movie-card">
              <h3>${movieTitle} ‚Äì ${data.showtime}</h3>
              <p><strong>Seats Booked:</strong> ${data.seats.join(', ')}</p>
              <p><strong>Per Seat Price:</strong> ‚Çπ${data.price}</p>
              <p><strong>Booking Revenue:</strong> ‚Çπ${revenue}</p>
            </div>
          `;
          bookingContainer.innerHTML += bookingHTML;
        });

        bookingContainer.innerHTML += `
          <h3 style="margin-top: 20px;">üí∞ Total Revenue: ‚Çπ${totalRevenue}</h3>
        `;
      }).catch(err => {
        bookingContainer.innerHTML = "Error loading bookings: " + err.message;
      });
    }
  </script>

</body>
</html>
